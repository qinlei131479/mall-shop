<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tigshop.mapper.order.OrderItemMapper">


    <select id="getProductSalesVolumeByProductIdAndShopId" resultType="java.lang.Integer">
        SELECT sum(oi.quantity)
        FROM `order_item` oi
                 LEFT JOIN `order` o ON o.order_id = oi.order_id
        WHERE product_id = #{id}
          AND o.shop_id = #{shopId}
          AND o.order_status != 3
    </select>
</mapper>
